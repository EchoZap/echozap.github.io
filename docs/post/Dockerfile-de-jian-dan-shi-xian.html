<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    <script src='https://pub-43c06573bc27485093cd50efd04e9e7b.r2.dev/GmeekVercount.js'></script>
    <link rel="icon" href="https://pub-a25b6a83a2d846958fb63f69d07d79a5.r2.dev/avatar.jpg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="# æ„å»ºç¬¬ä¸€ä¸ªDockerfile

å‡è®¾è¯¥é•œåƒå®ç°çš„ç­‰åŒäºæˆ‘ä»¬åœ¨å·²ç»é…ç½®å¥½pythonç¯å¢ƒçš„æœºå™¨ä¸Šé€šè¿‡`python hello.py`å‘½ä»¤æ¥è¿è¡Œä¸€ä¸ªpythonè„šæœ¬

æ‰€ä»¥è¯¥Dockerfileçš„æ„å»ºæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨æ¡Œé¢æˆ–å…¶ä»–ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‡è®¾æ–‡ä»¶å¤¹åä¸ºdocker
2. åœ¨dockeræ–°å»ºä¸€ä¸ªhello.pyæ–‡ä»¶ï¼Œhello.pyå·²ç»å®ç°æ‰€éœ€åŠŸèƒ½
3. å†åœ¨dockeræ–°å»ºä¸€ä¸ª`Dockerfile`ï¼Œ**æ³¨æ„ï¼šä»…å¼€å¤´ä¸”å¿…é¡»å¤§å†™**

ä»¥ä¸‹æ˜¯Dockerfileå†…å®¹ï¼š

```shell
 
FROM python:3.9.19-alpine3.18
COPY hello.py /hello.py
 
CMD python hello.py
```

# Dockerfileè¯­æ³•è¯´æ˜

`Dockerfile` æ˜¯ Docker æ„å»ºé•œåƒçš„æè¿°æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œæè¿°äº†å¦‚ä½•ä»åŸºç¡€é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚">
<meta property="og:title" content="Dockerfileçš„ç®€å•å®ç°">
<meta property="og:description" content="# æ„å»ºç¬¬ä¸€ä¸ªDockerfile

å‡è®¾è¯¥é•œåƒå®ç°çš„ç­‰åŒäºæˆ‘ä»¬åœ¨å·²ç»é…ç½®å¥½pythonç¯å¢ƒçš„æœºå™¨ä¸Šé€šè¿‡`python hello.py`å‘½ä»¤æ¥è¿è¡Œä¸€ä¸ªpythonè„šæœ¬

æ‰€ä»¥è¯¥Dockerfileçš„æ„å»ºæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨æ¡Œé¢æˆ–å…¶ä»–ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‡è®¾æ–‡ä»¶å¤¹åä¸ºdocker
2. åœ¨dockeræ–°å»ºä¸€ä¸ªhello.pyæ–‡ä»¶ï¼Œhello.pyå·²ç»å®ç°æ‰€éœ€åŠŸèƒ½
3. å†åœ¨dockeræ–°å»ºä¸€ä¸ª`Dockerfile`ï¼Œ**æ³¨æ„ï¼šä»…å¼€å¤´ä¸”å¿…é¡»å¤§å†™**

ä»¥ä¸‹æ˜¯Dockerfileå†…å®¹ï¼š

```shell
 
FROM python:3.9.19-alpine3.18
COPY hello.py /hello.py
 
CMD python hello.py
```

# Dockerfileè¯­æ³•è¯´æ˜

`Dockerfile` æ˜¯ Docker æ„å»ºé•œåƒçš„æè¿°æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œæè¿°äº†å¦‚ä½•ä»åŸºç¡€é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.ronan.cloudns.ch/post/Dockerfile-de-jian-dan-shi-xian.html">
<meta property="og:image" content="https://pub-a25b6a83a2d846958fb63f69d07d79a5.r2.dev/avatar.jpg">
<title>Dockerfileçš„ç®€å•å®ç°</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}

/* æ–°æ’å…¥======================================================================= */
/* ===== åŸºç¡€å®šä½ ===== */
.snippet-clipboard-content {
    position: relative;
}

/* å³ä¸Šè§’ hover çƒ­åŒº */
.snippet-clipboard-content .clipboard-container {
    position: absolute;
    top: 8px;
    right: 8px;
    opacity: 0;
    /* pointer-events: none;  é’ˆå¯¹æ¡Œé¢ç«¯é¼ æ ‡ç§»åŠ¨æ—¶ä¸æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®ï¼Œæ³¨é‡Šå³å¯æ­£å¸¸è¿è¡Œ*/
    transition: opacity 0.2s ease;
}

/* åªæœ‰ hover å³ä¸Šè§’åŒºåŸŸæ‰æ˜¾ç¤º */
.snippet-clipboard-content .clipboard-container:hover,
.snippet-clipboard-content.show-copy .clipboard-container {
    opacity: 1;
    pointer-events: auto;
}

/* ç¼©å°å¤åˆ¶æŒ‰é’® */
.ClipboardButton {
    transform: scale(0.8);
    padding: 2px;
    border-radius: 6px;
}

/* hover æ•ˆæœ */
.ClipboardButton:hover {
    background-color: var(--color-btn-hover-bg);
}

/* å›¾æ ‡åŠ¨ç”» */
.octicon-copy,
.octicon-check {
    transition: transform 0.15s ease, opacity 0.15s ease;
}

.octicon-check {
    transform: scale(0.6);
}

.octicon-check:not(.d-none) {
    transform: scale(1);
}

/* ===== Tooltip é£æ ¼ Copied ===== */
.copy-feedback {
    position: absolute;
    top: 36px;
    right: 0;
    background: var(--color-neutral-emphasis-plus);
    color: var(--color-fg-on-emphasis);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    white-space: nowrap;
    opacity: 0;
    transform: translateY(-4px);
    transition: opacity 0.15s ease, transform 0.15s ease;
    pointer-events: none;
}

/* tooltip å°ç®­å¤´ */
.copy-feedback::after {
    content: "";
    position: absolute;
    top: -4px;
    right: 10px;
    border-width: 4px;
    border-style: solid;
    border-color: transparent transparent var(--color-neutral-emphasis-plus) transparent;
}

/* æ˜¾ç¤º tooltip */
.copy-feedback.show {
    opacity: 1;
    transform: translateY(0);
}

/* ===== æ¸…é™¤ä»£ç å—çºµå‘æ»šåŠ¨æ¡ï¼Œåªä¿ç•™æ¨ªå‘ ===== */
.snippet-clipboard-content {
    overflow-x: auto;
    overflow-y: hidden;
}

.snippet-clipboard-content pre {
    overflow: visible;
}

/* éšè—æ»šåŠ¨æ¡ä½†ä»å¯æ»šåŠ¨ */
.snippet-clipboard-content::-webkit-scrollbar {
    height: 0;
}

</style>




<body>
    <div id="header">
<h1 class="postTitle">Dockerfileçš„ç®€å•å®ç°</h1>
<div class="title-right">
    <a href="https://blog.ronan.cloudns.ch" id="buttonHome" class="btn btn-invisible circle" title="é¦–é¡µ">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="åˆ‡æ¢ä¸»é¢˜">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>æ„å»ºç¬¬ä¸€ä¸ªDockerfile</h1>
<p>å‡è®¾è¯¥é•œåƒå®ç°çš„ç­‰åŒäºæˆ‘ä»¬åœ¨å·²ç»é…ç½®å¥½pythonç¯å¢ƒçš„æœºå™¨ä¸Šé€šè¿‡<code class="notranslate">python hello.py</code>å‘½ä»¤æ¥è¿è¡Œä¸€ä¸ªpythonè„šæœ¬</p>
<p>æ‰€ä»¥è¯¥Dockerfileçš„æ„å»ºæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨æ¡Œé¢æˆ–å…¶ä»–ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‡è®¾æ–‡ä»¶å¤¹åä¸ºdocker</li>
<li>åœ¨dockeræ–°å»ºä¸€ä¸ªhello.pyæ–‡ä»¶ï¼Œhello.pyå·²ç»å®ç°æ‰€éœ€åŠŸèƒ½</li>
<li>å†åœ¨dockeræ–°å»ºä¸€ä¸ª<code class="notranslate">Dockerfile</code>ï¼Œ<strong>æ³¨æ„ï¼šä»…å¼€å¤´ä¸”å¿…é¡»å¤§å†™</strong></li>
</ol>
<p>ä»¥ä¸‹æ˜¯Dockerfileå†…å®¹ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"> 
FROM python:3.9.19-alpine3.18
COPY hello.py /hello.py
 
CMD python hello.py</pre></div>
<h1>Dockerfileè¯­æ³•è¯´æ˜</h1>
<p><code class="notranslate">Dockerfile</code> æ˜¯ Docker æ„å»ºé•œåƒçš„æè¿°æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œæè¿°äº†å¦‚ä½•ä»åŸºç¡€é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚</p>
<p>ä¸‹é¢æ˜¯ <code class="notranslate">Dockerfile</code> ä¸­å¸¸ç”¨æŒ‡ä»¤çš„è¯´æ˜åŠå…¶è¯­æ³•ï¼Œå‚è€ƒè‡ªDocker Dockerfile | èœé¸Ÿæ•™ç¨‹ (runoob.com)ï¼š</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th><code class="notranslate">Dockerfile</code> æŒ‡ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>FROM</td>
<td>æŒ‡å®šåŸºç¡€é•œåƒï¼Œç”¨äºåç»­çš„æŒ‡ä»¤æ„å»ºã€‚</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>æŒ‡å®šDockerfileçš„ä½œè€…/ç»´æŠ¤è€…ã€‚ï¼ˆå·²å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨LABELæŒ‡ä»¤ï¼‰</td>
</tr>
<tr>
<td>LABEL</td>
<td>æ·»åŠ é•œåƒçš„å…ƒæ•°æ®ï¼Œä½¿ç”¨é”®å€¼å¯¹çš„å½¢å¼ã€‚</td>
</tr>
<tr>
<td>RUN</td>
<td>åœ¨æ„å»ºè¿‡ç¨‹ä¸­åœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>CMD</td>
<td>æŒ‡å®šå®¹å™¨åˆ›å»ºæ—¶çš„é»˜è®¤å‘½ä»¤ã€‚ï¼ˆå¯ä»¥è¢«è¦†ç›–ï¼‰</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>è®¾ç½®å®¹å™¨åˆ›å»ºæ—¶çš„ä¸»è¦å‘½ä»¤ã€‚ï¼ˆä¸å¯è¢«è¦†ç›–ï¼‰</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>å£°æ˜å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç‰¹å®šç½‘ç»œç«¯å£ã€‚</td>
</tr>
<tr>
<td>ENV</td>
<td>åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</td>
</tr>
<tr>
<td>ADD</td>
<td>å°†æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹URLå¤åˆ¶åˆ°é•œåƒä¸­ã€‚</td>
</tr>
<tr>
<td>COPY</td>
<td>å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚</td>
</tr>
<tr>
<td>VOLUME</td>
<td>ä¸ºå®¹å™¨åˆ›å»ºæŒ‚è½½ç‚¹æˆ–å£°æ˜å·ã€‚</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>è®¾ç½®åç»­æŒ‡ä»¤çš„å·¥ä½œç›®å½•ã€‚</td>
</tr>
<tr>
<td>USER</td>
<td>æŒ‡å®šåç»­æŒ‡ä»¤çš„ç”¨æˆ·ä¸Šä¸‹æ–‡ã€‚</td>
</tr>
<tr>
<td>ARG</td>
<td>å®šä¹‰åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼ é€’ç»™æ„å»ºå™¨çš„å˜é‡ï¼Œå¯ä½¿ç”¨ "docker build" å‘½ä»¤è®¾ç½®ã€‚</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>å½“è¯¥é•œåƒè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºè¿‡ç¨‹çš„åŸºç¡€æ—¶ï¼Œæ·»åŠ è§¦å‘å™¨ã€‚</td>
</tr>
<tr>
<td>STOPSIGNAL</td>
<td>è®¾ç½®å‘é€ç»™å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚</td>
</tr>
<tr>
<td>HEALTHCHECK</td>
<td>å®šä¹‰å‘¨æœŸæ€§æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€çš„å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>SHELL</td>
<td>è¦†ç›–Dockerä¸­é»˜è®¤çš„shellï¼Œç”¨äºRUNã€CMDå’ŒENTRYPOINTæŒ‡ä»¤ã€‚</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p>è¯¦ç»†è¯´æ˜ï¼š</p>
<h4>1. <code class="notranslate">FROM</code></h4>
<p>æŒ‡å®šæ„å»ºé•œåƒæ‰€åŸºäºçš„åŸºç¡€é•œåƒã€‚æ¯ä¸ª Dockerfile å¿…é¡»ä»¥ <code class="notranslate">FROM</code> æŒ‡ä»¤å¼€å§‹ã€‚</p>
<p>FROMæ˜¯å¿…é¡»çš„ï¼Œè¿™æ˜¯æ­å»ºé•œåƒçš„åŸºç¡€</p>
<ul>
<li><code class="notranslate">python:3.9.19-alpine3.18</code>å‰é¢çš„<code class="notranslate">python</code>ä¸ºé•œåƒåç§°ï¼Œå¯åˆ°dockerhubæŒ‰éœ€æœç´¢ï¼Œå¦‚ä¸‹å›¾</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/5f45757817537ae5da648bc08dec97e4deeb4e18e90bdf64e84415d7169522a6/68747470733a2f2f7075622d61323562366138336132643834363935386662363366363964303764373961352e72322e6465762f646f636b657266696c65312e706e67"><img src="https://camo.githubusercontent.com/5f45757817537ae5da648bc08dec97e4deeb4e18e90bdf64e84415d7169522a6/68747470733a2f2f7075622d61323562366138336132643834363935386662363366363964303764373961352e72322e6465762f646f636b657266696c65312e706e67" alt="img" data-canonical-src="https://pub-a25b6a83a2d846958fb63f69d07d79a5.r2.dev/dockerfile1.png" style="max-width: 100%;"></a></p>
<ul>
<li><code class="notranslate">python:3.9.19-alpine3.18</code>å†’å·åé¢çš„æ˜¯tagï¼Œä¹Ÿå°±æ˜¯æ ‡ç­¾(ç‰ˆæœ¬å·)ã€‚<strong>æ ‡ç­¾å¿…é¡»ä¸dockerhubé•œåƒé‡Œæä¾›çš„ä¸€è‡´ï¼Œåœ¨ä¸Šå›¾ç‚¹å‡»æ‰€éœ€é•œåƒåç§°å³å¯çœ‹åˆ°å¯ç”¨æ ‡ç­¾ã€‚</strong></li>
</ul>
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c95bab3d7188e17e3921f5b2de21285221e67c950de9c02d7228ffd880501bb4/68747470733a2f2f7075622d61323562366138336132643834363935386662363366363964303764373961352e72322e6465762f646f636b657266696c65322e706e67"><img src="https://camo.githubusercontent.com/c95bab3d7188e17e3921f5b2de21285221e67c950de9c02d7228ffd880501bb4/68747470733a2f2f7075622d61323562366138336132643834363935386662363366363964303764373961352e72322e6465762f646f636b657266696c65322e706e67" alt="img" data-canonical-src="https://pub-a25b6a83a2d846958fb63f69d07d79a5.r2.dev/dockerfile2.png" style="max-width: 100%;"></a></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">FROMÂ ubuntu:20.04
 </pre></div>
<h4>2. <code class="notranslate">LABEL</code></h4>
<p>LABEL æŒ‡ä»¤ç”¨æ¥ç»™é•œåƒæ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">LABEL <span class="pl-k">&lt;</span>key<span class="pl-k">&gt;</span>=<span class="pl-k">&lt;</span>value<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>key<span class="pl-k">&gt;</span>=<span class="pl-k">&lt;</span>value<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>key<span class="pl-k">&gt;</span>=<span class="pl-k">&lt;</span>value<span class="pl-k">&gt;</span> ...</pre></div>
<p>ä¾‹å¦‚æ·»åŠ é•œåƒä½œè€…ä¿¡æ¯ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">LABELÂ maintainer=<span class="pl-s"><span class="pl-pds">"</span>your-email@example.com<span class="pl-pds">"</span></span></pre></div>
<h4>3. <code class="notranslate">ENV</code></h4>
<p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡åœ¨æ„å»ºå’Œè¿è¡Œå®¹å™¨æ—¶éƒ½ä¼šå­˜åœ¨ã€‚</p>
<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ENVÂ <span class="pl-k">&lt;</span>key<span class="pl-k">&gt;</span>Â <span class="pl-k">&lt;</span>value<span class="pl-k">&gt;</span>
ENVÂ <span class="pl-k">&lt;</span>key<span class="pl-k">1&gt;</span>=<span class="pl-k">&lt;</span>value<span class="pl-k">1&gt;</span>Â <span class="pl-k">&lt;</span>key<span class="pl-k">2&gt;</span>=<span class="pl-k">&lt;</span>value<span class="pl-k">2&gt;</span>...</pre></div>
<p>ä»¥ä¸‹ç¤ºä¾‹è®¾ç½® NODE_VERSION = 7.2.0 ï¼Œ åœ¨åç»­çš„æŒ‡ä»¤ä¸­å¯ä»¥é€šè¿‡ $NODE_VERSION å¼•ç”¨ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ENVÂ NODE_VERSIONÂ 7.2.0

RUNÂ curlÂ -SLOÂ <span class="pl-s"><span class="pl-pds">"</span>https://nodejs.org/dist/v<span class="pl-smi">$NODE_VERSION</span>/node-v<span class="pl-smi">$NODE_VERSION</span>-linux-x64.tar.xz<span class="pl-pds">"</span></span>Â \
Â Â <span class="pl-k">&amp;&amp;</span>Â curlÂ -SLOÂ <span class="pl-s"><span class="pl-pds">"</span>https://nodejs.org/dist/v<span class="pl-smi">$NODE_VERSION</span>/SHASUMS256.txt.asc<span class="pl-pds">"</span></span></pre></div>
<h4>4. <code class="notranslate">RUN</code></h4>
<p>æ‰§è¡Œå‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤åœ¨æ„å»ºé•œåƒæ—¶æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€ä¿®æ”¹æ–‡ä»¶ç­‰æ“ä½œã€‚</p>
<p>RUNå‘½ä»¤æœ‰ä¿©ç§æ ¼å¼ï¼š</p>
<p>1ï¼‰shell æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">RUNÂ <span class="pl-k">&lt;</span>å‘½ä»¤è¡Œå‘½ä»¤<span class="pl-k">&gt;</span>
<span class="pl-c"><span class="pl-c">#</span>Â &lt;å‘½ä»¤è¡Œå‘½ä»¤&gt;Â ç­‰åŒäºï¼Œåœ¨ç»ˆç«¯æ“ä½œçš„ shell å‘½ä»¤ã€‚</span></pre></div>
<p>2ï¼‰exec æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">RUNÂ [<span class="pl-s"><span class="pl-pds">"</span>å¯æ‰§è¡Œæ–‡ä»¶<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>å‚æ•°1<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>å‚æ•°2<span class="pl-pds">"</span></span>]
<span class="pl-c"><span class="pl-c">#</span>Â ä¾‹å¦‚ï¼š</span>
<span class="pl-c"><span class="pl-c">#</span>Â RUNÂ ["./test.php",Â "dev",Â "offline"]Â ç­‰ä»·äºÂ RUNÂ ./test.phpÂ devÂ offline</span></pre></div>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code class="notranslate">Dockerfile</code> çš„æŒ‡ä»¤æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šåœ¨ docker ä¸Šæ–°å»ºä¸€å±‚ã€‚æ‰€ä»¥è¿‡å¤šæ— æ„ä¹‰çš„å±‚ï¼Œä¼šé€ æˆé•œåƒè†¨èƒ€è¿‡å¤§ã€‚å°½é‡å°†å‘½ä»¤è¡ŒæŒ‡ä»¤é€šè¿‡<code class="notranslate">&amp;&amp;</code>è¿æ¥å†™ä¸ºä¸€æ¡æŒ‡ä»¤ã€‚</p>
</blockquote>
<div class="highlight highlight-source-shell"><pre class="notranslate">RUNÂ apt-getÂ updateÂ <span class="pl-k">&amp;&amp;</span>Â \
 
Â Â Â Â apt-getÂ installÂ -yÂ --no-install-recommendsÂ \
Â Â Â Â curlÂ \
Â Â Â Â vimÂ \
Â Â Â Â gitÂ \
Â Â Â Â <span class="pl-k">&amp;&amp;</span>Â rmÂ -rfÂ /var/lib/apt/lists/<span class="pl-k">*</span></pre></div>
<h4>5. <code class="notranslate">COPY</code></h4>
<p>å¤åˆ¶æŒ‡ä»¤ï¼Œä»ä¸Šä¸‹æ–‡ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¹å™¨é‡ŒæŒ‡å®šè·¯å¾„ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">COPYÂ [--chown<span class="pl-k">=&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>group<span class="pl-k">&gt;</span>]Â <span class="pl-k">&lt;</span>æºè·¯å¾„<span class="pl-k">1&gt;</span>...Â Â <span class="pl-k">&lt;</span>ç›®æ ‡è·¯å¾„<span class="pl-k">&gt;</span>
COPYÂ [--chown<span class="pl-k">=&lt;</span>user<span class="pl-k">&gt;</span>:<span class="pl-k">&lt;</span>group<span class="pl-k">&gt;</span>]Â [<span class="pl-s"><span class="pl-pds">"</span>&lt;æºè·¯å¾„1&gt;<span class="pl-pds">"</span></span>,...Â Â <span class="pl-s"><span class="pl-pds">"</span>&lt;ç›®æ ‡è·¯å¾„&gt;<span class="pl-pds">"</span></span>]</pre></div>
<p><strong>[--chown=:]</strong>ï¼šå¯é€‰å‚æ•°ï¼Œç”¨æˆ·æ”¹å˜å¤åˆ¶åˆ°å®¹å™¨å†…æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œå±ç»„ã€‚</p>
<p><strong>&lt;æºè·¯å¾„&gt;</strong>ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•ï¼Œè¿™é‡Œå¯ä»¥æ˜¯é€šé…ç¬¦è¡¨è¾¾å¼ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">COPYÂ hom<span class="pl-k">*</span>Â /mydir/
COPYÂ hom<span class="pl-k">?</span>.txtÂ /mydir/</pre></div>
<p><strong>&lt;ç›®æ ‡è·¯å¾„&gt;</strong>ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p>
<h4>6. <code class="notranslate">ADD</code></h4>
<p>ADD æŒ‡ä»¤å’Œ COPY çš„ä½¿ç”¨æ ¼ç±»ä¼¼ï¼ˆ<strong>åŒæ ·éœ€æ±‚ä¸‹ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ COPY</strong>ï¼‰ã€‚åŠŸèƒ½ä¹Ÿç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„å¦‚ä¸‹ï¼š</p>
<ul>
<li>ADD çš„ä¼˜ç‚¹ï¼šåœ¨æ‰§è¡Œ &lt;æºæ–‡ä»¶&gt; ä¸º tar å‹ç¼©æ–‡ä»¶çš„è¯ï¼Œå‹ç¼©æ ¼å¼ä¸º gzip, bzip2 ä»¥åŠ xz çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶å¹¶è§£å‹åˆ° &lt;ç›®æ ‡è·¯å¾„&gt;ã€‚</li>
<li>ADD çš„ç¼ºç‚¹ï¼šåœ¨ä¸è§£å‹çš„å‰æä¸‹ï¼Œæ— æ³•å¤åˆ¶ tar å‹ç¼©æ–‡ä»¶ã€‚ä¼šä»¤é•œåƒæ„å»ºç¼“å­˜å¤±æ•ˆï¼Œä»è€Œå¯èƒ½ä¼šä»¤é•œåƒæ„å»ºå˜å¾—æ¯”è¾ƒç¼“æ…¢ã€‚å…·ä½“æ˜¯å¦ä½¿ç”¨ï¼Œå¯ä»¥æ ¹æ®æ˜¯å¦éœ€è¦è‡ªåŠ¨è§£å‹æ¥å†³å®šã€‚</li>
</ul>
<h4>7. <code class="notranslate">WORKDIR</code></h4>
<p>æŒ‡å®šå·¥ä½œç›®å½•ã€‚ç”¨ WORKDIR æŒ‡å®šçš„å·¥ä½œç›®å½•ï¼Œä¼šåœ¨æ„å»ºé•œåƒçš„æ¯ä¸€å±‚ä¸­éƒ½å­˜åœ¨ã€‚ä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚è¯¥ç›®å½•ä¸å­˜åœ¨ï¼ŒWORKDIR ä¼šå¸®ä½ å»ºç«‹ç›®å½•ã€‚</p>
<p>docker build æ„å»ºé•œåƒè¿‡ç¨‹ä¸­çš„ï¼Œæ¯ä¸€ä¸ª RUN å‘½ä»¤éƒ½æ˜¯æ–°å»ºçš„ä¸€å±‚ã€‚åªæœ‰é€šè¿‡ WORKDIR åˆ›å»ºçš„ç›®å½•æ‰ä¼šä¸€ç›´å­˜åœ¨ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">WORKDIRÂ <span class="pl-k">&lt;</span>å·¥ä½œç›®å½•è·¯å¾„<span class="pl-k">&gt;</span></pre></div>
<h4>8. <code class="notranslate">EXPOSE</code></h4>
<p>ä»…ä»…åªæ˜¯å£°æ˜ç«¯å£ï¼Œæ­¤æŒ‡ä»¤ä¸ä¼šå®é™…å‘å¸ƒç«¯å£ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ã€‚</li>
<li>åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ <code class="notranslate">docker run -P</code> æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£ã€‚</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">EXPOSEÂ <span class="pl-k">&lt;</span>ç«¯å£<span class="pl-k">1&gt;</span>Â [<span class="pl-k">&lt;</span>ç«¯å£<span class="pl-k">2&gt;</span>...]</pre></div>
<h4>9. <code class="notranslate">CMD</code></h4>
<p>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚<code class="notranslate">CMD</code> æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºå¯è¢« docker run å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šè¦è¿è¡Œçš„ç¨‹åºæ‰€è¦†ç›–ã€‚</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>nginx<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>-g<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>daemonÂ off;<span class="pl-pds">"</span></span>]</pre></div>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">CMDÂ <span class="pl-k">&lt;</span>shellÂ å‘½ä»¤<span class="pl-k">&gt;</span>Â 
CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>&lt;å¯æ‰§è¡Œæ–‡ä»¶æˆ–å‘½ä»¤&gt;<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>&lt;param1&gt;<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>&lt;param2&gt;<span class="pl-pds">"</span></span>,...]Â 
CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>&lt;param1&gt;<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>&lt;param2&gt;<span class="pl-pds">"</span></span>,...]Â Â <span class="pl-c"><span class="pl-c">#</span>Â è¯¥å†™æ³•æ˜¯ä¸ºÂ ENTRYPOINTÂ æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºæä¾›é»˜è®¤å‚æ•°</span></pre></div>
<p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ ¼å¼ï¼Œæ‰§è¡Œè¿‡ç¨‹æ¯”è¾ƒæ˜ç¡®ã€‚ç¬¬ä¸€ç§æ ¼å¼å®é™…ä¸Šåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šè‡ªåŠ¨è½¬æ¢æˆç¬¬äºŒç§æ ¼å¼è¿è¡Œï¼Œå¹¶ä¸”é»˜è®¤å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ shã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ <code class="notranslate">Dockerfile</code> ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª <code class="notranslate">CMD</code>æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<h4>10. <code class="notranslate">ENTRYPOINT</code></h4>
<p>ç±»ä¼¼äº <code class="notranslate">CMD</code>ï¼Œä½†ä¸èƒ½è¢« <code class="notranslate">docker run</code> æä¾›çš„å‚æ•°è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p>
<p>å¦‚æœè¿è¡Œ docker run æ—¶ä½¿ç”¨äº† <code class="notranslate">--entrypoint</code> é€‰é¡¹ï¼Œå°†è¦†ç›– <code class="notranslate">ENTRYPOINT</code> æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚é€šå¸¸ç”¨æ¥è®¾ç½®ä¸å¯å˜çš„éƒ¨åˆ†ï¼Œ<code class="notranslate">CMD</code> ç”¨æ¥æŒ‡å®šå¯å˜çš„å‚æ•°ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ENTRYPOINTÂ [<span class="pl-s"><span class="pl-pds">"</span>&lt;executeable&gt;<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>&lt;param1&gt;<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>&lt;param2&gt;<span class="pl-pds">"</span></span>,...]</pre></div>
<p>æ­é… CMD å‘½ä»¤ä½¿ç”¨ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ENTRYPOINTÂ [<span class="pl-s"><span class="pl-pds">"</span>nginx<span class="pl-pds">"</span></span>]
CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>-g<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>daemonÂ off;<span class="pl-pds">"</span></span>]</pre></div>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ <code class="notranslate">Dockerfile</code> ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª <code class="notranslate">ENTRYPOINT</code> æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>å‡è®¾å·²é€šè¿‡ <code class="notranslate">Dockerfile</code> æ„å»ºäº† <code class="notranslate">nginx:test</code> é•œåƒï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">FROMÂ nginx

ENTRYPOINTÂ [<span class="pl-s"><span class="pl-pds">"</span>nginx<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>-c<span class="pl-pds">"</span></span>]Â <span class="pl-c"><span class="pl-c">#</span>Â å®šå‚</span>
CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>/etc/nginx/nginx.conf<span class="pl-pds">"</span></span>]Â <span class="pl-c"><span class="pl-c">#</span>Â å˜å‚Â </span></pre></div>
<p>1ã€ä¸ä¼ å‚è¿è¡Œ</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">$Â dockerÂ runÂ Â nginx:test</pre></div>
<p>å®¹å™¨å†…ä¼šé»˜è®¤è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹ã€‚</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">nginxÂ -cÂ /etc/nginx/nginx.conf
 </pre></div>
<p>2ã€ä¼ å‚è¿è¡Œ</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">$Â dockerÂ runÂ Â nginx:testÂ -cÂ /etc/nginx/new.conf</pre></div>
<p>å®¹å™¨å†…ä¼šé»˜è®¤è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹(/etc/nginx/new.conf:å‡è®¾å®¹å™¨å†…å·²æœ‰æ­¤æ–‡ä»¶)</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">nginxÂ -cÂ /etc/nginx/new.conf</pre></div>
<h4>11. <code class="notranslate">VOLUME</code></h4>
<p>å®šä¹‰åŒ¿åæ•°æ®å·ã€‚åœ¨å¯åŠ¨å®¹å™¨æ—¶å¿˜è®°æŒ‚è½½æ•°æ®å·ï¼Œä¼šè‡ªåŠ¨æŒ‚è½½åˆ°åŒ¿åå·ã€‚åˆ›å»ºæŒ‚è½½ç‚¹ï¼Œå£°æ˜äº†å®¹å™¨ä¸­çš„ä¸€ä¸ªç›®å½•å°†ä½œä¸ºæ•°æ®å·ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>é¿å…é‡è¦çš„æ•°æ®ï¼Œå› å®¹å™¨é‡å¯è€Œä¸¢å¤±ï¼Œè¿™æ˜¯éå¸¸è‡´å‘½çš„ã€‚</li>
<li>é¿å…å®¹å™¨ä¸æ–­å˜å¤§ã€‚</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">VOLUMEÂ [<span class="pl-s"><span class="pl-pds">"</span>&lt;è·¯å¾„1&gt;<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>&lt;è·¯å¾„2&gt;<span class="pl-pds">"</span></span>...]
VOLUMEÂ <span class="pl-k">&lt;</span>è·¯å¾„<span class="pl-k">&gt;</span></pre></div>
<p>åœ¨å¯åŠ¨å®¹å™¨ docker run çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ -v å‚æ•°ä¿®æ”¹æŒ‚è½½ç‚¹ã€‚</p>
<h4>12. <code class="notranslate">USER</code></h4>
<p>ç”¨äºæŒ‡å®šæ‰§è¡Œåç»­å‘½ä»¤çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œè¿™è¾¹åªæ˜¯åˆ‡æ¢åç»­å‘½ä»¤æ‰§è¡Œçš„ç”¨æˆ·ï¼ˆç”¨æˆ·å’Œç”¨æˆ·ç»„å¿…é¡»æå‰å·²ç»å­˜åœ¨ï¼‰ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">USERÂ <span class="pl-k">&lt;</span>ç”¨æˆ·å<span class="pl-k">&gt;</span>[:<span class="pl-k">&lt;</span>ç”¨æˆ·ç»„<span class="pl-k">&gt;</span>]</pre></div>
<h4>13. <code class="notranslate">ARG</code></h4>
<p>æ„å»ºå‚æ•°ï¼Œä¸ ENV ä½œç”¨ä¸€è‡´ã€‚ä¸è¿‡ä½œç”¨åŸŸä¸ä¸€æ ·ã€‚ARG è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»…å¯¹ Dockerfile å†…æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ docker build çš„è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œæ„å»ºå¥½çš„é•œåƒå†…ä¸å­˜åœ¨æ­¤ç¯å¢ƒå˜é‡ã€‚</p>
<p>æ„å»ºå‘½ä»¤ docker build ä¸­å¯ä»¥ç”¨ --build-arg &lt;å‚æ•°å&gt;=&lt;å€¼&gt; æ¥è¦†ç›–ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ARGÂ <span class="pl-k">&lt;</span>å‚æ•°å<span class="pl-k">&gt;</span>[<span class="pl-k">=&lt;</span>é»˜è®¤å€¼<span class="pl-k">&gt;</span>]</pre></div>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ARGÂ VERSION=1.0
RUNÂ echoÂ <span class="pl-s"><span class="pl-pds">"</span>Version:Â <span class="pl-smi">$VERSION</span><span class="pl-pds">"</span></span></pre></div>
<h4>14. <code class="notranslate">HEALTHCHECK</code></h4>
<p>ç”¨äºæŒ‡å®šæŸä¸ªç¨‹åºæˆ–è€…æŒ‡ä»¤æ¥ç›‘æ§ docker å®¹å™¨æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">HEALTHCHECK [é€‰é¡¹] CMD <span class="pl-k">&lt;</span>å‘½ä»¤<span class="pl-k">&gt;</span>ï¼šè®¾ç½®æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µçš„å‘½ä»¤
HEALTHCHECK NONEï¼šå¦‚æœåŸºç¡€é•œåƒæœ‰å¥åº·æ£€æŸ¥æŒ‡ä»¤ï¼Œä½¿ç”¨è¿™è¡Œå¯ä»¥å±è”½æ‰å…¶å¥åº·æ£€æŸ¥æŒ‡ä»¤

HEALTHCHECK [é€‰é¡¹] CMD <span class="pl-k">&lt;</span>å‘½ä»¤<span class="pl-k">&gt;</span>Â :Â è¿™è¾¹ CMD åé¢è·Ÿéšçš„å‘½ä»¤ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ CMD çš„ç”¨æ³•ã€‚</pre></div>
<h4>15. <code class="notranslate">ONBUILD</code></h4>
<p>ç”¨äºå»¶è¿Ÿæ„å»ºå‘½ä»¤çš„æ‰§è¡Œã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ Dockerfile é‡Œç”¨ ONBUILD æŒ‡å®šçš„å‘½ä»¤ï¼Œåœ¨æœ¬æ¬¡æ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­ä¸ä¼šæ‰§è¡Œï¼ˆå‡è®¾é•œåƒä¸º test-buildï¼‰ã€‚å½“æœ‰æ–°çš„ <code class="notranslate">Dockerfile</code> ä½¿ç”¨äº†ä¹‹å‰æ„å»ºçš„é•œåƒ FROM test-build ï¼Œè¿™æ—¶æ‰§è¡Œæ–°é•œåƒçš„ <code class="notranslate">Dockerfile</code> æ„å»ºæ—¶å€™ï¼Œä¼šæ‰§è¡Œ test-build çš„ Dockerfile é‡Œçš„ ONBUILD æŒ‡å®šçš„å‘½ä»¤ã€‚</p>
<p>æ ¼å¼ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ONBUILDÂ <span class="pl-k">&lt;</span>å…¶å®ƒæŒ‡ä»¤<span class="pl-k">&gt;</span></pre></div>
<h1>æ„å»ºé•œåƒå®æˆ˜</h1>
<h3>1. åˆ›å»º <code class="notranslate">Dockerfile</code></h3>
<p><code class="notranslate">Dockerfile</code> æ˜¯ä¸€ä¸ªåŒ…å«æ„å»ºé•œåƒæŒ‡ä»¤çš„æ–‡æœ¬æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ <code class="notranslate">Dockerfile</code>ï¼Œå®ƒæ„å»ºäº†ä¸€ä¸ªåŸºäº Ubuntu çš„åŸºç¡€é•œåƒï¼Œå¹¶å®‰è£…äº†ä¸€äº›å¸¸ç”¨çš„å·¥å…·ã€‚****</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code class="notranslate">Dockerfile</code> çš„æ–‡ä»¶ã€‚</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>Â ä½¿ç”¨å®˜æ–¹çš„Â PythonÂ ä½œä¸ºåŸºç¡€é•œåƒ</span>
FROMÂ python:3.10-slim

<span class="pl-c"><span class="pl-c">#</span>Â è®¾ç½®å·¥ä½œç›®å½•</span>
WORKDIRÂ /app

<span class="pl-c"><span class="pl-c">#</span>Â å¤åˆ¶æœ¬åœ°çš„Â requirements.txtÂ æ–‡ä»¶åˆ°é•œåƒä¸­</span>
COPYÂ requirements.txtÂ requirements.txt

<span class="pl-c"><span class="pl-c">#</span>Â å®‰è£…ä¾èµ–åŒ…</span>
RUNÂ pipÂ installÂ --no-cache-dirÂ -rÂ requirements.txt

<span class="pl-c"><span class="pl-c">#</span>Â å¤åˆ¶å½“å‰ç›®å½•å†…å®¹åˆ°é•œåƒä¸­çš„Â /appÂ ç›®å½•</span>
COPYÂ .Â .

<span class="pl-c"><span class="pl-c">#</span>Â æš´éœ²åº”ç”¨è¿è¡Œçš„ç«¯å£</span>
EXPOSEÂ 5000

<span class="pl-c"><span class="pl-c">#</span>Â è®¾ç½®ç¯å¢ƒå˜é‡</span>
ENVÂ FLASK_APP=app.py
ENVÂ FLASK_RUN_HOST=0.0.0.0

<span class="pl-c"><span class="pl-c">#</span>Â è¿è¡ŒÂ FlaskÂ åº”ç”¨</span>
CMDÂ [<span class="pl-s"><span class="pl-pds">"</span>flask<span class="pl-pds">"</span></span>,Â <span class="pl-s"><span class="pl-pds">"</span>run<span class="pl-pds">"</span></span>]</pre></div>
<p>ç›®å½•ç»“æ„ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">my_flask_app/
â”‚
â”œâ”€â”€Â Dockerfile
â”œâ”€â”€Â app.py
â””â”€â”€Â requirements.txt</pre></div>
<p>requirements.txtæ–‡ä»¶å†…å®¹ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">Flask</pre></div>
<p>Flask åº”ç”¨ç¨‹åºæ–‡ä»¶ <code class="notranslate">app.py</code>ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">fromÂ flaskÂ importÂ Flask

appÂ =Â Flask(__name__)

@app.route(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>)
<span class="pl-en">defÂ hello_world</span>():
Â Â Â Â returnÂ <span class="pl-s"><span class="pl-pds">'</span>Hello,Â World!<span class="pl-pds">'</span></span>

ifÂ __name__Â ==Â <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
Â Â Â Â app.run(host=<span class="pl-s"><span class="pl-pds">'</span>0.0.0.0<span class="pl-pds">'</span></span>)</pre></div>
<h3>2. æ„å»º Docker é•œåƒ</h3>
<ol>
<li>åœ¨ Dockerfile æ‰€åœ¨ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º Docker é•œåƒï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ buildÂ -tÂ myflaskapp:1.0Â .
 </pre></div>
<p>ä»¥ä¸Šå‘½ä»¤å°†æ ¹æ® <code class="notranslate">Dockerfile</code> çš„å†…å®¹æ„å»ºé•œåƒï¼Œå¹¶å°†å…¶æ ‡è®°ä¸º <code class="notranslate">mybaseimage:1.0</code>ã€‚</p>
<h3>3. éªŒè¯åŠç®¡ç†é•œåƒ</h3>
<ol>
<li>æ„å»ºå®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å·²åˆ›å»ºçš„é•œåƒï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ images</pre></div>
<p>æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">REPOSITORYÂ Â Â Â Â Â Â TAGÂ Â Â Â Â Â Â Â Â Â IMAGEÂ IDÂ Â Â Â Â Â Â CREATEDÂ Â Â Â Â Â Â Â Â Â SIZE
myflaskappÂ Â Â Â Â Â Â 1.0Â Â Â Â Â Â Â Â Â Â a405b0aca5f0Â Â Â 10Â minutesÂ agoÂ Â Â 133MB</pre></div>
<ol start="2">
<li>æŸ¥çœ‹é•œåƒçš„å„ä¸ªå±‚</li>
</ol>
<p>æŸ¥çœ‹é•œåƒçš„å„ä¸ªå±‚ï¼Œè¯·ä½¿ç”¨ docker history å‘½ä»¤</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ historyÂ myflaskapp:1.0
<span class="pl-c"><span class="pl-c">#</span>Â æˆ–è€…</span>
dockerÂ inspectÂ myflaskapp:1.0
 </pre></div>
<ol start="3">
<li>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ–°åˆ›å»ºçš„é•œåƒï¼Œä»¥ç¡®ä¿å…¶å·¥ä½œæ­£å¸¸ï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">[root@k8s-masterÂ my_flask_app]<span class="pl-c"><span class="pl-c">#</span>Â dockerÂ runÂ -dÂ -pÂ 5000:5000Â myflaskapp:1.0</span>
 
426420bedd2754508643d5cea5430911c4900809e608b649470e3989b53ed0f1
[root@k8s-masterÂ my_flask_app]<span class="pl-c"><span class="pl-c">#</span>Â ssÂ -tulnpÂ |Â grepÂ 5000</span>
tcpÂ Â Â Â LISTENÂ Â Â Â Â 0Â Â Â Â Â Â 128Â Â Â Â Â Â Â <span class="pl-k">*</span>:5000Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="pl-k">*</span>:<span class="pl-k">*</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â users:<span class="pl-s"><span class="pl-pds">((</span>"docker<span class="pl-k">-</span>proxy"<span class="pl-k">,</span>pid<span class="pl-k">=</span><span class="pl-c1">55916</span><span class="pl-k">,</span>fd<span class="pl-k">=</span><span class="pl-c1">4</span><span class="pl-pds">))</span></span>
tcpÂ Â Â Â LISTENÂ Â Â Â Â 0Â Â Â Â Â Â 128Â Â Â Â [::]:5000Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [::]:<span class="pl-k">*</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â users:<span class="pl-s"><span class="pl-pds">((</span>"docker<span class="pl-k">-</span>proxy"<span class="pl-k">,</span>pid<span class="pl-k">=</span><span class="pl-c1">55922</span><span class="pl-k">,</span>fd<span class="pl-k">=</span><span class="pl-c1">4</span><span class="pl-pds">))</span></span>
[root@k8s-masterÂ my_flask_app]<span class="pl-c"><span class="pl-c">#</span>Â curlÂ 127.0.0.1:5000</span>
Hello,Â World<span class="pl-k">!</span></pre></div>
<ol start="4">
<li>åˆ é™¤é•œåƒ(æŒ‰éœ€)</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ imageÂ rmÂ myflaskapp:1.0</pre></div>
<h3>4. æ¨é€é•œåƒåˆ° Docker ä»“åº“ï¼ˆå¯é€‰ï¼‰</h3>
<p>å¦‚æœæ‚¨å¸Œæœ›å°†é•œåƒåˆ†äº«ç»™å…¶ä»–äººæˆ–åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶æ¨é€åˆ° Docker Hub æˆ–å…¶ä»– Docker é•œåƒä»“åº“ã€‚</p>
<ol>
<li>ç™»å½•åˆ° Docker Hubï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ login</pre></div>
<ol start="2">
<li>ç»™é•œåƒæ‰“æ ‡ç­¾ï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ tagÂ my-images:1.0Â your-dockerhub-username/my-images:1.0</pre></div>
<ol start="3">
<li>æ¨é€é•œåƒåˆ° Docker Hubï¼š</li>
</ol>
<div class="highlight highlight-source-shell"><pre class="notranslate">dockerÂ pushÂ your-dockerhub-username/my-images:1.0</pre></div>
<h3>æ€»ç»“</h3>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»æˆåŠŸæ„å»ºäº†ä¸€ä¸ªåº”ç”¨å®¹å™¨é•œåƒï¼Œå¹¶å¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶å’Œæ‰©å±•è¿™ä¸ªé•œåƒã€‚</p></div>
<div style="font-size:small;margin-top:8px;float:right;">è¦åšä¸€ä¸ªæœ‰swagçš„äºº</div>

</div>
    <div id="footer"><div id="footer1">Copyright Â© <span id="copyrightYear"></span> <a href="https://blog.ronan.cloudns.ch">ç½—åä¸œ_@Ronan_ä¸ªäººåšå®¢</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek  https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);





document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            

            
            copyIcon.classList.add('d-none');
			
			checkIcon.classList.remove('d-none');
			copyFeedback.classList.add('show');

			setTimeout(() => {
    			copyIcon.classList.remove('d-none');
    			checkIcon.classList.add('d-none');
    			copyFeedback.classList.remove('show');
			}, 2000);



            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.classList.add('show');
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.classList.remove('show');
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
    
    
/* ===== æ–°å¢ï¼šç§»åŠ¨ç«¯é•¿æŒ‰æ˜¾ç¤ºå¤åˆ¶æŒ‰é’® ===== */

// document.querySelectorAll('.snippet-clipboard-content').forEach(block => {
//     let pressTimer;

//     block.addEventListener('touchstart', () => {
//         pressTimer = setTimeout(() => {
//             block.classList.add('show-copy');
//         }, 500);
//     });

//     block.addEventListener('touchend', () => {
//         clearTimeout(pressTimer);
//         setTimeout(() => {
//             block.classList.remove('show-copy');
//         }, 3000);
//     });
// });


/* ===== ç§»åŠ¨ç«¯ï¼šé•¿æŒ‰ 3 ç§’ç›´æ¥å¤åˆ¶ï¼ˆiOS / Android ç¨³å®šç‰ˆï¼‰ ===== */
document.querySelectorAll('.snippet-clipboard-content').forEach(block => {
    let pressTimer;

    block.addEventListener('touchstart', () => {
        pressTimer = setTimeout(async () => {
            const codeEl = block.querySelector('pre code');
            if (!codeEl) return;

            const text = codeEl.innerText;

            let copied = false;

            // â‘  ä¼˜å…ˆä½¿ç”¨ç°ä»£ Clipboard API
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(text);
                    copied = true;
                }
            } catch (e) {}

            // â‘¡ fallbackï¼šé€‰ä¸­æ–‡æœ¬ï¼ˆiOS å¿…é¡»ï¼‰
            if (!copied) {
                const range = document.createRange();
                range.selectNodeContents(codeEl);

                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);

                try {
                    document.execCommand('copy');
                    copied = true;
                } catch (e) {}

                selection.removeAllRanges();
            }

            // æ˜¾ç¤ºæç¤º
            const feedback = block.querySelector('.copy-feedback');
            if (copied && feedback) {
                feedback.textContent = 'ä»£ç å·²å¤åˆ¶';
                feedback.classList.add('show');

                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            }
        }, 3000); // ğŸ‘ˆ é•¿æŒ‰ 3 ç§’
    });

    block.addEventListener('touchend', () => {
        clearTimeout(pressTimer);
    });

    block.addEventListener('touchmove', () => {
        clearTimeout(pressTimer);
    });
});


/* ===== æ–°å¢ç»“æŸ ===== */

});

</script>
<script src='https://pub-43c06573bc27485093cd50efd04e9e7b.r2.dev/GmeekTOC.js'></script><script src='https://pub-43c06573bc27485093cd50efd04e9e7b.r2.dev/Gmeeklightbox.js'></script><script>document.querySelectorAll('a').forEach(anchor => {const img = anchor.querySelector('img');if (img && img.hasAttribute('data-canonical-src')) {const canonicalSrc = img.getAttribute('data-canonical-src');anchor.setAttribute('href', canonicalSrc);img.setAttribute('src', canonicalSrc);img.removeAttribute('data-canonical-src');}});</script>

</html>
